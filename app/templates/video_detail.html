{% extends 'layout.html' %}
{% block content %}
<div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
  <h2 style="margin:0;">{{ video.title }}</h2>
  {% if current_user.is_authenticated and current_user.is_admin %}
  <div>
    <a href="{{ url_for('video.edit', vid=video.id) }}" style="padding:6px 12px; background:#2196f3; color:#fff; text-decoration:none; border-radius:4px; font-size:14px;">ç¼–è¾‘</a>
  </div>
  {% endif %}
</div>

{% if not video.is_public %}
<div style="padding:8px 12px; background:#fff3cd; border:1px solid #ffc107; border-radius:4px; margin-bottom:12px; font-size:14px;">
  ğŸ”’ ç§æœ‰è§†é¢‘
</div>
{% endif %}

<video id="video-player" controls width="800" style="max-width:100%;" preload="auto" crossorigin="anonymous">
  <source src="{{ url_for('video.stream', vid=video.id) }}" type="video/mp4">
  æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾
</video>

<div style="margin-top:12px;">
  <label style="font-size:14px; margin-right:8px;">æ’­æ”¾é€Ÿåº¦ï¼š</label>
  <button onclick="setSpeed(0.5)">0.5x</button>
  <button onclick="setSpeed(0.75)">0.75x</button>
  <button onclick="setSpeed(1)" style="font-weight:bold;">1x</button>
  <button onclick="setSpeed(1.25)">1.25x</button>
  <button onclick="setSpeed(1.5)">1.5x</button>
  <button onclick="setSpeed(2)">2x</button>
  <span id="speed-display" style="margin-left:12px; color:#666; font-size:14px;">å½“å‰: 1x</span>
</div>

<p style="color:#666; font-size:14px; margin-top:8px;">
  æç¤ºï¼šè§†é¢‘ä¼šè‡ªåŠ¨ç¼“å­˜åˆ°æµè§ˆå™¨ï¼Œç½‘ç»œå·®æ—¶å¯æš‚åœç­‰å¾…ç¼“å†²
</p>

<script>
const video = document.getElementById('video-player');
const speedDisplay = document.getElementById('speed-display');

function setSpeed(rate) {
  video.playbackRate = rate;
  speedDisplay.textContent = 'å½“å‰: ' + rate + 'x';
  
  // é«˜äº®å½“å‰é€Ÿåº¦æŒ‰é’®
  document.querySelectorAll('button').forEach(btn => {
    btn.style.fontWeight = 'normal';
    btn.style.background = '';
  });
  event.target.style.fontWeight = 'bold';
  event.target.style.background = '#e3f2fd';
}

// è®°ä½ç”¨æˆ·é€‰æ‹©çš„é€Ÿåº¦
video.addEventListener('ratechange', function() {
  localStorage.setItem('videoPlaybackRate', video.playbackRate);
});

// æ¢å¤ä¸Šæ¬¡çš„æ’­æ”¾é€Ÿåº¦
window.addEventListener('load', function() {
  const savedRate = localStorage.getItem('videoPlaybackRate');
  if (savedRate) {
    video.playbackRate = parseFloat(savedRate);
    speedDisplay.textContent = 'å½“å‰: ' + savedRate + 'x';
  }
});
</script>
{% endblock %}